--DROP TABLE IF EXISTS compute_accounting;
/*
CREATE TABLE compute_accounting (
  job_number INTEGER UNSIGNED NOT NULL, 
  end_date TIMESTAMP NOT NULL,
  PRIMARY KEY(job_number),
  UNIQUE INDEX job_number_uk_ind (job_number)
)
ENGINE InnoDB;
*/
CREATE TABLE compute_accounting_part (
  qname    VARCHAR(50) NOT NULL,
  hostname VARCHAR(50) NOT NULL,
  group_name VARCHAR(50) NOT NULL,
  owner    VARCHAR(50) NOT NULL,
  jobname    VARCHAR(50) NOT NULL,
  jobnumber  BIGINT(20) UNSIGNED NOT NULL,
  account    VARCHAR(50) NOT NULL,
  priority   INTEGER UNSIGNED NOT NULL,
  qsub_time  TIMESTAMP NOT NULL,
  start_time TIMESTAMP NOT NULL,
  end_time   TIMESTAMP NOT NULL,
  failed     VARCHAR(50) NOT NULL,
  exit_status  INTEGER UNSIGNED NOT NULL,
  ru_wallclock BIGINT(20) UNSIGNED NOT NULL,
  project  VARCHAR(50) NOT NULL,
  department VARCHAR(50) NOT NULL,
  granted_pe VARCHAR(50) NOT NULL,
  slots      INTEGER UNSIGNED NOT NULL,
  taskid     VARCHAR(50) NOT NULL,
  cpu          BIGINT(20) UNSIGNED NOT NULL,
  mem          BIGINT(20) UNSIGNED NOT NULL,
  io           BIGINT(20) UNSIGNED NOT NULL,
  category VARCHAR(50) NOT NULL,
  iow          BIGINT(20) UNSIGNED NOT NULL,
  pe_taskid VARCHAR(50) NOT NULL,
  maxvmem      BIGINT(20) UNSIGNED NOT NULL,
  -- ru_utime     BIGINT(20) UNSIGNED NOT NULL,
  -- ru_stime     BIGINT(20) UNSIGNED NOT NULL,
  -- ru_maxrss    BIGINT(20) UNSIGNED NOT NULL,
  -- ru_ixrss     BIGINT(20) UNSIGNED NOT NULL,
  -- ru_ismrss    BIGINT(20) UNSIGNED NOT NULL,
  -- ru_idrss     BIGINT(20) UNSIGNED NOT NULL,
  -- ru_isrss     BIGINT(20) UNSIGNED NOT NULL,
  -- ru_minflt    BIGINT(20) UNSIGNED NOT NULL,
  -- ru_majflt    BIGINT(20) UNSIGNED NOT NULL,
  -- ru_nswap     BIGINT(20) UNSIGNED NOT NULL,
  -- ru_inblock   BIGINT(20) UNSIGNED NOT NULL,
  -- ru_oublock   BIGINT(20) UNSIGNED NOT NULL,
  -- ru_msgsnd    BIGINT(20) UNSIGNED NOT NULL,
  -- ru_msgrcv    BIGINT(20) UNSIGNED NOT NULL,
  -- ru_nsignals  BIGINT(20) UNSIGNED NOT NULL,
  -- ru_nvcsw     BIGINT(20) UNSIGNED NOT NULL,
  -- ru_nivcsw    BIGINT(20) UNSIGNED NOT NULL,
  PRIMARY KEY(jobnumber,hostname)
)
PARTITION BY RANGE (TO_DAYS(end_time))
(
PARTITION P200605 VALUES LESS THAN (to_days('2006-06-01')),
PARTITION P200606 VALUES LESS THAN (to_days('2006-07-01')),
PARTITION P200607 VALUES LESS THAN (to_days('2006-08-01')),
PARTITION P200608 VALUES LESS THAN (to_days('2006-09-01')),
PARTITION P200609 VALUES LESS THAN (to_days('2006-10-01')),
PARTITION P200610 VALUES LESS THAN (to_days('2006-11-01')),
PARTITION P200611 VALUES LESS THAN (to_days('2006-12-01')),
PARTITION P200612 VALUES LESS THAN (to_days('2007-01-01')),
PARTITION P200701 VALUES LESS THAN (to_days('2007-02-01')),
PARTITION P200702 VALUES LESS THAN (to_days('2007-03-01')),
PARTITION P200703 VALUES LESS THAN (to_days('2007-04-01')),
PARTITION P200704 VALUES LESS THAN (to_days('2007-05-01')),
PARTITION P200705 VALUES LESS THAN (to_days('2007-06-01')),
PARTITION P200706 VALUES LESS THAN (to_days('2007-07-01')),
PARTITION P200707 VALUES LESS THAN (to_days('2007-08-01')),
PARTITION P200708 VALUES LESS THAN (to_days('2007-09-01')),
PARTITION P200709 VALUES LESS THAN (to_days('2007-10-01')),
PARTITION P200710 VALUES LESS THAN (to_days('2007-11-01')),
PARTITION P200711 VALUES LESS THAN (to_days('2007-12-01')),
PARTITION P200712 VALUES LESS THAN (to_days('2008-01-01')),
PARTITION P200801 VALUES LESS THAN (to_days('2008-02-01')),
PARTITION P200802 VALUES LESS THAN (to_days('2008-03-01')),
PARTITION P200803 VALUES LESS THAN (to_days('2008-04-01')),
PARTITION P200804 VALUES LESS THAN (to_days('2008-05-01')),
PARTITION P200805 VALUES LESS THAN (to_days('2008-06-01')),
PARTITION P200806 VALUES LESS THAN (to_days('2008-07-01')),
PARTITION P200807 VALUES LESS THAN (to_days('2008-08-01')),
PARTITION P200808 VALUES LESS THAN (to_days('2008-09-01')),
PARTITION P200809 VALUES LESS THAN (to_days('2008-10-01')),
PARTITION P200810 VALUES LESS THAN (to_days('2008-11-01')),
PARTITION P200811 VALUES LESS THAN (to_days('2008-12-01')),
PARTITION P200812 VALUES LESS THAN (to_days('2009-01-01')),
PARTITION P200901 VALUES LESS THAN (to_days('2009-02-01')),
PARTITION P200902 VALUES LESS THAN (to_days('2009-03-01')),
PARTITION P200903 VALUES LESS THAN (to_days('2009-04-01')),
PARTITION P200904 VALUES LESS THAN (to_days('2009-05-01')),
PARTITION P200905 VALUES LESS THAN (to_days('2009-06-01')),
PARTITION P200906 VALUES LESS THAN (to_days('2009-07-01')),
PARTITION P200907 VALUES LESS THAN (to_days('2009-08-01')),
PARTITION P200908 VALUES LESS THAN (to_days('2009-09-01')),
PARTITION P200909 VALUES LESS THAN (to_days('2009-10-01')),
PARTITION P200910 VALUES LESS THAN (to_days('2009-11-01')),
PARTITION P200911 VALUES LESS THAN (to_days('2009-12-01')),
PARTITION P200912 VALUES LESS THAN (to_days('2010-01-01')),
PARTITION P201001 VALUES LESS THAN (to_days('2010-02-01')),
PARTITION P201002 VALUES LESS THAN (to_days('2010-03-01')),
PARTITION P201003 VALUES LESS THAN (to_days('2010-04-01')),
PARTITION P201004 VALUES LESS THAN (to_days('2010-05-01')),
PARTITION P201005 VALUES LESS THAN (to_days('2010-06-01')),
PARTITION P201006 VALUES LESS THAN (to_days('2010-07-01')),
PARTITION P201007 VALUES LESS THAN (to_days('2010-08-01')),
PARTITION P201008 VALUES LESS THAN (to_days('2010-09-01')),
PARTITION P201009 VALUES LESS THAN (to_days('2010-10-01')),
PARTITION P201010 VALUES LESS THAN (to_days('2010-11-01')),
PARTITION P201011 VALUES LESS THAN (to_days('2010-12-01')),
PARTITION P201012 VALUES LESS THAN (to_days('2011-01-01')),
PARTITION P201101 VALUES LESS THAN (to_days('2011-02-01')),
PARTITION P201102 VALUES LESS THAN (to_days('2011-03-01')),
PARTITION P201103 VALUES LESS THAN (to_days('2011-04-01')),
PARTITION P201104 VALUES LESS THAN (to_days('2011-05-01')),
PARTITION P201105 VALUES LESS THAN (to_days('2011-06-01')),
PARTITION P201106 VALUES LESS THAN (to_days('2011-07-01')),
PARTITION P201107 VALUES LESS THAN (to_days('2011-08-01')),
PARTITION P201108 VALUES LESS THAN (to_days('2011-09-01')),
PARTITION P201109 VALUES LESS THAN (to_days('2011-10-01')),
PARTITION P201110 VALUES LESS THAN (to_days('2011-11-01')),
PARTITION P201111 VALUES LESS THAN (to_days('2011-12-01')),
PARTITION P201112 VALUES LESS THAN (to_days('2012-01-01')),
PARTITION P201201 VALUES LESS THAN (to_days('2012-02-01')),
PARTITION P201202 VALUES LESS THAN (to_days('2012-03-01')),
PARTITION P201203 VALUES LESS THAN (to_days('2012-04-01')),
PARTITION P201204 VALUES LESS THAN (to_days('2012-05-01')),
PARTITION P201205 VALUES LESS THAN (to_days('2012-06-01')),
PARTITION P201206 VALUES LESS THAN (to_days('2012-07-01')),
PARTITION P201207 VALUES LESS THAN (to_days('2012-08-01')),
PARTITION P201208 VALUES LESS THAN (to_days('2012-09-01')),
PARTITION P201209 VALUES LESS THAN (to_days('2012-10-01')),
PARTITION P201210 VALUES LESS THAN (to_days('2012-11-01')),
PARTITION P201211 VALUES LESS THAN (to_days('2012-12-01')),
PARTITION P201212 VALUES LESS THAN (to_days('2013-01-01')),
PARTITION P201301 VALUES LESS THAN (to_days('2013-02-01')),
PARTITION P201302 VALUES LESS THAN (to_days('2013-03-01')),
PARTITION P201303 VALUES LESS THAN (to_days('2013-04-01')),
PARTITION P201304 VALUES LESS THAN (to_days('2013-05-01')),
PARTITION P201305 VALUES LESS THAN (to_days('2013-06-01')),
PARTITION P201306 VALUES LESS THAN (to_days('2013-07-01')),
PARTITION P201307 VALUES LESS THAN (to_days('2013-08-01')),
PARTITION P201308 VALUES LESS THAN (to_days('2013-09-01')),
PARTITION P201309 VALUES LESS THAN (to_days('2013-10-01')),
PARTITION P201310 VALUES LESS THAN (to_days('2013-11-01')),
PARTITION P201311 VALUES LESS THAN (to_days('2013-12-01')),
PARTITION P201312 VALUES LESS THAN (to_days('2014-01-01')),
PARTITION P201401 VALUES LESS THAN (to_days('2014-02-01')),
PARTITION P201402 VALUES LESS THAN (to_days('2014-03-01')),
PARTITION P201403 VALUES LESS THAN (to_days('2014-04-01')),
PARTITION P201404 VALUES LESS THAN (to_days('2014-05-01')),
PARTITION P201405 VALUES LESS THAN (to_days('2014-06-01')),
PARTITION P201406 VALUES LESS THAN (to_days('2014-07-01')),
PARTITION P201407 VALUES LESS THAN (to_days('2014-08-01')),
PARTITION P201408 VALUES LESS THAN (to_days('2014-09-01')),
PARTITION P201409 VALUES LESS THAN (to_days('2014-10-01')),
PARTITION P201410 VALUES LESS THAN (to_days('2014-11-01')),
PARTITION P201411 VALUES LESS THAN (to_days('2014-12-01')),
PARTITION P201412 VALUES LESS THAN (to_days('2015-01-01')),
PARTITION P201501 VALUES LESS THAN (to_days('2015-02-01')),
PARTITION P201502 VALUES LESS THAN (to_days('2015-03-01')),
PARTITION P201503 VALUES LESS THAN (to_days('2015-04-01')),
PARTITION P201504 VALUES LESS THAN (to_days('2015-05-01')),
PARTITION P201505 VALUES LESS THAN (to_days('2015-06-01')),
PARTITION P201506 VALUES LESS THAN (to_days('2015-07-01')),
PARTITION P201507 VALUES LESS THAN (to_days('2015-08-01')),
PARTITION P201508 VALUES LESS THAN (to_days('2015-09-01')),
PARTITION P201509 VALUES LESS THAN (to_days('2015-10-01')),
PARTITION P201510 VALUES LESS THAN (to_days('2015-11-01')),
PARTITION P201511 VALUES LESS THAN (to_days('2015-12-01')),
PARTITION P201512 VALUES LESS THAN (to_days('2016-01-01')),
PARTITION P2016 VALUES LESS THAN (MAXVALUE)
)
ENGINE InnoDB;

-- CREATE INDEX end_time_ind USING BTREE ON compute_accounting(end_time);

